package com.example.myapplication

import android.app.Activity
import android.content.Context
import android.content.Intent
import android.content.pm.PackageManager
import android.graphics.Bitmap
import android.graphics.BitmapFactory
import android.graphics.Color
import android.graphics.ImageDecoder
import android.net.Uri
import android.os.Build
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.provider.MediaStore
import android.util.Log
import android.view.View
import android.widget.LinearLayout
import android.widget.Toast
import androidx.core.app.ActivityCompat
import androidx.core.content.ContextCompat
import androidx.viewpager2.widget.ViewPager2
import com.example.myapplication.databinding.ActivityMainBinding
import com.google.android.material.tabs.TabLayout
import okhttp3.*
import org.opencv.android.OpenCVLoader
import org.opencv.android.Utils
import org.opencv.core.Mat

import org.opencv.core.Size
import org.opencv.imgproc.Imgproc
import java.io.IOException

class MainActivity : AppCompatActivity() {

    private lateinit var tabLayout: TabLayout
    private lateinit var viewPager2: ViewPager2
    private lateinit var adapter : FragmentPageAdapter
    private lateinit var binding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        tabLayout = binding.tabLayout
        viewPager2 = binding.viewPager2
        adapter = FragmentPageAdapter(supportFragmentManager, lifecycle)

        tabLayout.addTab(tabLayout.newTab().setText("Рисунок"))
        tabLayout.addTab(tabLayout.newTab().setText("Загрузка"))

        viewPager2.adapter = adapter

        tabLayout.addOnTabSelectedListener(object : TabLayout.OnTabSelectedListener{
            override fun onTabSelected(tab: TabLayout.Tab?) {
                if (tab != null){
                    viewPager2.currentItem = tab.position
                }
            }

            override fun onTabUnselected(tab: TabLayout.Tab?) {
                //
            }

            override fun onTabReselected(tab: TabLayout.Tab?) {
                //2
            }
        })

        /*binding.button2.setOnClickListener {
//            post()
            val url = "http://192.164.4.2/getdata"
            val message = "[0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00," +
                    "0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00,0xF00]"
            sendPostRequest(url, message)
        }*/

        viewPager2.registerOnPageChangeCallback(object : ViewPager2.OnPageChangeCallback(){
            override fun onPageSelected(position: Int) {
                super.onPageSelected(position)
                tabLayout.selectTab(tabLayout.getTabAt(position))
            }
        })
    }


}
